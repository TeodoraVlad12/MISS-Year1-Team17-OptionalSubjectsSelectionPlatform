sequenceDiagram
    participant S as Student
    participant UI as Web Interface
    participant Auth as Authentication Service
    participant API as University API
    participant DB as Database
    participant AS as Allocation System
    participant NS as Notification Service

    Note over S,NS: Student Authentication and Profile Setup
    S->>UI: Access system
    UI->>Auth: Request authentication
    Auth->>S: Redirect to institutional login
    S->>Auth: Enter institutional email credentials
    Auth->>API: Validate credentials
    API-->>Auth: Authentication successful
    Auth->>API: Request student data (matriculation number)
    API-->>Auth: Return student profile data
    Auth-->>UI: Authentication token + student data
    UI-->>S: Display dashboard with profile

    Note over S,NS: View Available Optional Subjects
    S->>UI: Navigate to subjects page
    UI->>DB: Query available subjects for student's year/semester
    DB-->>UI: Return subjects list (name, description, coordinator, capacity)
    UI-->>S: Display available optional subjects

    Note over S,NS: Submit Preference Rankings
    S->>UI: Select and rank preferred subjects
    UI->>UI: Validate selection (required number, no duplicates)
    S->>UI: Confirm preference submission
    UI->>DB: Store student preferences with rankings
    DB-->>UI: Confirmation of storage
    UI-->>S: Display success message
    UI->>NS: Trigger confirmation email
    NS->>S: Send preference confirmation email

    Note over S,NS: Modify Preferences (Before Deadline)
    S->>UI: Request to modify preferences
    UI->>DB: Check if deadline has passed
    DB-->>UI: Deadline status
    alt Deadline not passed
        UI-->>S: Allow preference modification
        S->>UI: Update preference rankings
        UI->>DB: Update stored preferences
        DB-->>UI: Update confirmation
        UI-->>S: Display updated preferences
    else Deadline passed
        UI-->>S: Display error - deadline exceeded
    end

    Note over S,NS: Receive Assignment Notification
    Note right of AS: Allocation process happens<br/>in background (admin-triggered)
    AS->>DB: Store assignment results
    AS->>NS: Trigger assignment notifications
    NS->>S: Email notification of assignment

    Note over S,NS: View Assignment Results
    S->>UI: Check assignment results
    UI->>DB: Query student assignments
    DB-->>UI: Return assigned subjects
    UI-->>S: Display assigned optional subjects

    Note over S,NS: Request Subject Transfer
    S->>UI: Request transfer from assigned subject
    UI->>UI: Display available subjects for transfer
    S->>UI: Select desired subject for transfer
    UI->>DB: Store transfer request
    DB-->>UI: Transfer request stored
    UI-->>S: Display transfer request confirmation
    UI->>NS: Notify about transfer request
    NS->>S: Transfer request confirmation email

    Note over S,NS: Receive Transfer Decision
    Note right of DB: Transfer processing happens<br/>in background (admin review)
    DB->>NS: Transfer decision made
    NS->>S: Transfer approval/rejection notification

    Note over S,NS: Check Transfer Status
    S->>UI: View transfer status
    UI->>DB: Query transfer request status
    DB-->>UI: Return current status
    UI-->>S: Display transfer status

    Note over S,NS: System Notifications (Throughout Process)
    loop Notification Events
        NS->>S: Selection period opening
        NS->>S: Deadline reminders
        NS->>S: Assignment results
        NS->>S: Transfer status updates
    end
