---
config:
  theme: default
  themeVariables:
    primaryColor: '#f1f8ff'
    tertiaryColor: '#ffffff'
    fontSize: 14px
    fontFamily: ''
    primaryBorderColor: '#1565c0'
    lineColor: '#607d8b'
    edgeLabelBackground: '#ffffff'
  flowchart:
    curve: basis
---
flowchart LR
 subgraph CL["ğŸ“ Client Layer"]
        student["ğŸ§‘â€ğŸ“ Student Web Browser"]
        admin["ğŸ§‘â€ğŸ’¼ Admin Web Browser"]
  end
 subgraph AUTH["ğŸ” University Authentication Layer"]
        authsvc["ğŸ”‘ Auth Service<br>(OIDC / SAML)"]
        univapi["ğŸ›ï¸ Institutional API<br>(Student Data)"]
  end
 subgraph WEB["ğŸ’» Web Frontend Layer"]
        frontend["ğŸŒ Student/Admin Web App"]
  end
 subgraph API["ğŸ§© Backend API Layer"]
        api["âš™ï¸ Main API Gateway"]
        alloc["ğŸ“Š Allocation Service<br>(Galeâ€“Shapley)"]
        transfer["ğŸ” Transfer Manager"]
        notify["ğŸ“§ Notification Service"]
  end
 subgraph DATA["ğŸ—„ï¸ Data Layer"]
        usersdb["ğŸ‘¥ Users DB"]
        prefsdb["ğŸ—‚ Preferences DB"]
        subjectsdb["ğŸ“˜ Subjects DB"]
        transfersdb["ğŸ”„ Transfers DB"]
        gradesdb["ğŸ… Grades DB"]
  end
 subgraph INFRA["â˜ï¸ Infrastructure Layer"]
        queue["ğŸ“¬ Message Queue"]
        smtp["ğŸ“¨ SMTP Server"]
        storage["ğŸ’¾ File Storage / Backups"]
  end
    student -- ğŸŒ HTTPS Request --> frontend
    admin -- ğŸŒ HTTPS Request --> frontend
    frontend -- ğŸ“¡ REST / GraphQL API Calls --> api
    api -- ğŸ”’ Auth via OIDC / SAML --> authsvc
    authsvc -- ğŸ“– Fetch Student Data --> univapi
    api -- âš™ï¸ Trigger Allocation --> alloc
    api -- ğŸ” Manage Transfers --> transfer
    api -- ğŸ“§ Send Notifications --> notify
    alloc -- ğŸ“¥ Read Preferences --> prefsdb
    alloc -- ğŸ“š Read Subjects --> subjectsdb
    alloc -- ğŸ“ Access Grades --> gradesdb
    alloc -- ğŸ‘¤ Access Users --> usersdb
    transfer -- ğŸ”„ Handle Requests --> transfersdb
    transfer -- ğŸ“š Access Subjects --> subjectsdb
    notify -- ğŸ“¨ Push Message --> queue
    queue -- âœ‰ï¸ Deliver Email --> smtp
    api -- ğŸ§¾ CRUD Operations --> usersdb & prefsdb & subjectsdb & transfersdb & gradesdb
    DATA -- ğŸ’¾ Daily Backups --> storage
    api -- ğŸ›ï¸ Fetch Student Info --> univapi
    X4[" "]
    X3[" "]
    X2[" "]
    X1[" "]
     DATA:::layer
     X4:::invis
     X4:::invis
     INFRA:::layer
     X3:::invis
     X3:::invis
     X2:::invis
     X2:::invis
     X1:::invis
     X1:::invis
     API:::layer
     WEB:::layer
     CL:::layer
    classDef layer fill:#fafafa,stroke:#1565c0,stroke-width:2px,corner-radius:10px
    classDef invis stroke:none,fill:none
